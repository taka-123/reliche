# Phase 3: 品質管理・コミュニティ機能とAI学習システム実装 TODO リスト

## 🚀 実装タスク

### 📊 3.1 レシピ評価システム（優先度: 高）

#### データベース設計
- [x] `recipe_reviews` テーブルマイグレーション作成
  ```sql
  recipe_reviews:
    id, recipe_id, user_id
    rating (1-5), taste_score, difficulty_score, instruction_clarity
    comment (TEXT), review_images (JSON)
    監査カラム一式 (created_at, created_by, updated_at, updated_by, deleted_at, deleted_by)
  ```
- [x] RecipeReviewモデル作成
- [x] Recipeモデル評価関連リレーション追加

#### 評価機能実装
- [x] 5段階評価システム実装
  - [x] 総合評価 (rating)
  - [x] 味評価 (taste_score)
  - [x] 難易度評価 (difficulty_score)
  - [x] 手順明確性評価 (instruction_clarity)
- [x] レビューコメント機能
- [x] 評価統計・集計機能
- [ ] レシピ画像・動画投稿機能

#### API・UI 実装
- [x] レビュー投稿APIエンドポイント (`POST /api/recipes/{id}/reviews`)
- [x] レビュー取得APIエンドポイント (`GET /api/recipes/{id}/reviews`)
- [x] レビュー統計APIエンドポイント (`GET /api/recipes/{id}/reviews/statistics`)
- [x] レビュー更新・削除APIエンドポイント
- [x] レビュー表示・管理UI (フロントエンド)
  - [x] ReviewFormコンポーネント（投稿・編集フォーム）
  - [x] ReviewListコンポーネント（一覧・統計表示）
  - [x] レシピ詳細ページへの統合
  - [x] Playwright E2Eテスト実装
  - [x] ユニットテスト実装
  - [x] TypeScript型安全性確保
- [/] 評価による並び替え・フィルタリング機能（基本実装済み）

### 🤖 3.2 品質管理自動化（優先度: 高）

#### 自動品質チェック
- [x] 低評価レシピ検出システム
  - [x] 評価3未満レシピの自動検出ロジック
  - [x] アラート・通知機能
- [x] 自動削除バッチ機能
  - [x] `QualityCheckCommand` Artisanコマンド作成
  - [x] 一定期間低評価レシピの削除機能
  - [x] 削除前の人的確認ワークフロー

#### 代替レシピ自動生成
- [x] 削除レシピの代替生成システム
  - [x] 同カテゴリ・類似条件での自動生成
  - [x] 品質向上を反映した新レシピ作成
- [x] 週次/月次品質チェック機能
  - [x] 定期的な品質レポート生成
  - [x] 改善提案の自動生成

### 👥 3.3 ユーザー投稿・コミュニティ機能（優先度: 中）

#### メディア投稿システム
- [ ] `recipe_media` テーブルマイグレーション作成
  ```sql
  recipe_media:
    id, recipe_id, user_id
    media_type (image/video), file_path, original_filename
    file_size, mime_type, metadata (JSON)
    description, is_approved, approved_by, approved_at
    監査カラム一式
  ```
- [ ] RecipeMediaモデル作成

#### 投稿機能実装
- [ ] 画像・動画アップロード機能
- [ ] ファイル形式・サイズ制限設定
- [ ] 投稿コンテンツ管理・承認システム
- [ ] 画像最適化・圧縮機能

#### コミュニティ機能
- [ ] ユーザーレビュー画像表示機能
- [ ] 投稿コンテンツのモデレーション機能
- [ ] ユーザー貢献度システム
- [ ] コミュニティガイドライン実装

### 🧠 3.4 AI 学習・最適化システム（優先度: 中）

#### ユーザー好み学習
- [ ] `user_behaviors` テーブル作成
  - [ ] 閲覧履歴、評価履歴、検索パターン記録
  - [ ] お気に入り登録、シェア行動記録
- [ ] 個人化推薦システム
  - [ ] 好み分析による個別レシピ推薦
  - [ ] 過去の評価を反映した生成調整

#### 季節・トレンド対応
- [ ] `seasonal_ingredients` テーブル作成
  - [ ] 旬の食材マスタ管理
  - [ ] 季節別レシピ重み付け
- [ ] トレンド分析機能
  - [ ] 人気レシピパターン分析
  - [ ] 流行の調理法・食材検出

#### フィードバック学習
- [ ] 評価データのAIフィードバック機能
  - [ ] 低評価要因の分析
  - [ ] プロンプト改善提案の自動生成
- [ ] A/Bテスト機能
  - [ ] 複数プロンプトパターンのテスト
  - [ ] 最適プロンプトの自動選択

### 🔍 3.5 高度検索・分析機能（優先度: 低）

#### 検索最適化
- [ ] `recipe_search_index` テーブル実装
  ```sql
  recipe_search_index:
    recipe_id (PRIMARY), searchable_text, tags_text, ingredients_text
    updated_at, FULLTEXT インデックス
  ```
- [ ] Elasticsearch 本格導入検討
  - [ ] 全文検索の高速化
  - [ ] 複雑な検索クエリ対応

#### 分析・レポート機能
- [ ] レシピ分析ダッシュボード
  - [ ] 人気度、評価傾向、利用統計
- [ ] ユーザー行動分析
  - [ ] 利用パターン、満足度分析
- [ ] AI生成品質メトリクス
  - [ ] 生成成功率、品質スコア推移

## 📋 詳細技術仕様

### AI モデル統合
- **品質分析**: Gemini Pro - 詳細な評価・改善分析
- **代替生成**: Pro（バッチ） + Flash-Lite（リアルタイム）
- **学習フィードバック**: Pro - 複雑な分析・提案生成

### パフォーマンス最適化
- [ ] データベース最適化
  - [ ] インデックス戦略見直し
  - [ ] クエリ最適化
- [ ] キャッシュ戦略
  - [ ] Redis 活用検討
  - [ ] 評価・統計データキャッシュ
- [ ] CDN・画像最適化
  - [ ] ユーザー投稿メディアの配信最適化

## 🎯 マイルストーン

### Milestone 1: レビューシステム基盤（Week 1-2）
- [x] `recipe_reviews` テーブル実装完了
- [x] 基本評価・レビュー機能動作
- [x] API・UI統合完了 (API完了、UI実装完了)

### Milestone 2: 品質管理自動化（Week 3-4）
- [x] 自動品質チェックシステム動作
- [x] 代替レシピ生成機能完了
- [x] バッチコマンド実装完了

### Milestone 3: コミュニティ機能（Week 5-6）
- [ ] ユーザー投稿システム完了
- [ ] モデレーション機能動作
- [ ] メディア管理システム完了

### Milestone 4: AI 学習システム（Week 7-8）
- [ ] ユーザー好み学習機能完了
- [ ] 季節・トレンド対応機能完了
- [ ] フィードバック機能動作

### Milestone 5: 最適化・分析（Week 9-10）
- [ ] 検索最適化完了
- [ ] 分析ダッシュボード完了
- [ ] パフォーマンス最適化完了

### Milestone 6: 総合テスト・リリース（Week 11-12）
- [ ] 包括的テスト完了
- [ ] 全機能統合テスト通過
- [ ] 本番環境リリース

## ⚠️ 注意事項・リスク対策

### 技術リスク
- **AI学習コスト**: 効率的なバッチ処理、学習頻度調整
- **データ量増加**: スケーラブルアーキテクチャ、適切なインデックス
- **PostgreSQL維持**: 本番環境との一貫性保持（SQLite禁止）

### 品質リスク
- **自動削除誤判定**: 人的確認ワークフロー、閾値調整
- **コミュニティモデレーション**: 明確なガイドライン、段階的承認

### セキュリティ
- **ファイルアップロード**: 適切な検証、サニタイズ
- **ユーザーデータ**: プライバシー保護、適切な同意取得

## 🔍 品質チェックリスト

### レビューシステム
- [x] 評価データの整合性確保
- [x] 不正レビューの検出・防止 (1ユーザー1レシピ1レビュー制約)
- [/] レスポンス性能 < 500ms (未計測)

### 品質管理システム
- [x] 誤削除防止機能動作 (確認プロンプト、dry-runモード)
- [x] 代替生成品質 > 元レシピ (同カテゴリ改良生成)
- [x] バッチ処理の安定性確保 (エラーハンドリング、進捗表示)

### コミュニティ機能
- [ ] 不適切コンテンツの自動検出
- [ ] ファイルサイズ・形式制限動作
- [ ] 承認ワークフロー正常動作

## 📊 成功指標

### 品質面
- [ ] 平均レシピ評価 > 4.0/5.0
- [ ] 低評価レシピ比率 < 10%
- [ ] 自動品質改善システム稼働率 > 95%

### ユーザーエンゲージメント
- [ ] レビュー投稿率 > 30%（アクティブユーザー比）
- [ ] コミュニティ投稿率 > 15%
- [ ] 推薦レシピクリック率 > 25%

### AI 学習効果
- [ ] 個人化推薦精度 > 70%
- [ ] AIフィードバック適用後の品質向上 > 20%
- [ ] 季節レシピ推薦適合率 > 80%

## ✅ 実装進捗状況

**Phase 3 実装開始: 2025-01-27**

現在の状況:
- Phase 1 ✅ 完了: 基本AIレシピ生成機能
- Phase 2 ✅ 完了: ユーザー向け機能、栄養解説システム
- Phase 3 🚧 実装中: 品質管理・コミュニティ機能・AI学習システム

### 完了済み機能:
- ✅ **レシピ評価システム基盤** (2025-01-27完了)
  - recipe_reviewsテーブル設計・実装
  - RecipeReviewモデル・リレーション実装
  - 5段階評価システム (総合・味・難易度・手順明確性)
  - 完全なレビューAPI (投稿・取得・更新・削除・統計)
  - 適切な認証・権限制御・バリデーション

- ✅ **品質管理自動化システム** (2025-01-27完了)
  - QualityCheckCommand Artisanコマンド実装
  - 低評価レシピ自動検出・削除機能
  - 代替レシピ自動生成機能
  - 品質レポート生成機能
  - Dry-run・確認プロンプト等の安全機能

- ✅ **レビューシステムUI実装** (2025-07-27完了)
  - ReviewFormコンポーネント (投稿・編集フォーム)
  - ReviewListコンポーネント (一覧・統計表示)
  - レシピ詳細ページ統合
  - TypeScript型定義・API連携
  - Playwright E2Eテスト・ユニットテスト
  - ESLintルール準拠・コード品質確保

次のステップ: コミュニティ機能(メディア投稿システム)実装